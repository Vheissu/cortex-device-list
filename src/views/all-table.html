<div class="table-responsive">
    <table class="table" aurelia-table="data.bind: all; display-data.bind: $displayData; filters.bind: filters;">
        <thead>
            <tr>
                <th scope="col" aut-sort="key: name; default: asc">
                    <div class="d-flex align-items-center">
                        <span>Name</span>
                        <i class="bi bi-arrow-down-up ms-2 opacity-50"></i>
                    </div>
                </th>
                <th scope="col" aut-sort="key: real;" class="d-none d-lg-table-cell">
                    <div class="d-flex align-items-center">
                        <span>Based On</span>
                        <i class="bi bi-arrow-down-up ms-2 opacity-50"></i>
                    </div>
                </th>
                <th scope="col" aut-sort="key: deviceType">
                    <div class="d-flex align-items-center">
                        <span>Type</span>
                        <i class="bi bi-arrow-down-up ms-2 opacity-50"></i>
                    </div>
                </th>
                <th scope="col" aut-sort="key: addedIn" class="d-none d-md-table-cell">
                    <div class="d-flex align-items-center">
                        <span>CorOS Version</span>
                        <i class="bi bi-arrow-down-up ms-2 opacity-50"></i>
                    </div>
                </th>
            </tr>
            <tr>
                <th>
                    <input type="text"
                           class="form-control"
                           placeholder="Search devices..."
                           value.bind="filters[0].value">
                </th>
                <th class="d-none d-lg-table-cell">
                    <input type="text"
                           class="form-control"
                           placeholder="Search model..."
                           value.bind="filters[1].value">
                </th>
                <th>
                    <select class="form-select" value.bind="filters[2].value">
                        <option value="">All Types</option>
                        <option value="amp">Amplifiers</option>
                        <option value="cab">Cabinets</option>
                        <option value="effect">Effects</option>
                        <option value="capture">Captures</option>
                    </select>
                </th>
                <th class="d-none d-md-table-cell"></th>
            </tr>
        </thead>

        <tbody>
            <!-- Amplifiers Section -->
            <tr class="table-section" if.bind="getDevicesByType($displayData, 'amp').length">
                <td colspan="4" class="section-header" click.trigger="toggleSection('amp', $event)">
                    <div class="d-flex align-items-center justify-content-between">
                        <div class="d-flex align-items-center gap-3">
                            <span class="category-icon amp">
                                <i class="bi bi-speaker"></i>
                            </span>
                            <span class="fw-semibold">Amplifiers</span>
                            <span class="text-muted">(${getDevicesByType($displayData, 'amp').length})</span>
                        </div>
                        <i class="bi ${ampCollapsed ? 'bi-chevron-right' : 'bi-chevron-down'} text-muted"></i>
                    </div>
                </td>
            </tr>
            <tr repeat.for="device of getDevicesByType($displayData, 'amp')"
                if.bind="!ampCollapsed"
                class="fade-in">
                <td>
                    <div class="d-flex align-items-center gap-2">
                        <span click.trigger="showDetail(device)" class="device-name">${device.name}</span>
                        <a if.bind="getDetailForDevice(device)?.amazonAffiliateLink"
                           href="${getDetailForDevice(device).amazonAffiliateLink}"
                           target="_blank"
                           class="text-warning"
                           title="Buy on Amazon">
                            <i class="bi bi-amazon"></i>
                        </a>
                    </div>
                    <small class="d-block d-lg-none text-muted mt-1">${device.real}</small>
                </td>
                <td class="d-none d-lg-table-cell text-muted">${device.real}</td>
                <td>
                    <span class="badge bg-primary">Amplifier</span>
                </td>
                <td class="d-none d-md-table-cell">
                    <span if.bind="device.addedIn" class="badge purple">${device.addedIn}</span>
                </td>
            </tr>

            <!-- Cabinets Section -->
            <tr class="table-section" if.bind="getDevicesByType($displayData, 'cab').length">
                <td colspan="4" class="section-header" click.trigger="toggleSection('cab', $event)">
                    <div class="d-flex align-items-center justify-content-between">
                        <div class="d-flex align-items-center gap-3">
                            <span class="category-icon cab">
                                <i class="bi bi-box"></i>
                            </span>
                            <span class="fw-semibold">Cabinets</span>
                            <span class="text-muted">(${getDevicesByType($displayData, 'cab').length})</span>
                        </div>
                        <i class="bi ${cabCollapsed ? 'bi-chevron-right' : 'bi-chevron-down'} text-muted"></i>
                    </div>
                </td>
            </tr>
            <tr repeat.for="device of getDevicesByType($displayData, 'cab')"
                if.bind="!cabCollapsed"
                class="fade-in">
                <td>
                    <div class="d-flex align-items-center gap-2">
                        <span click.trigger="showDetail(device)" class="device-name">${device.name}</span>
                        <a if.bind="getDetailForDevice(device)?.amazonAffiliateLink"
                           href="${getDetailForDevice(device).amazonAffiliateLink}"
                           target="_blank"
                           class="text-warning"
                           title="Buy on Amazon">
                            <i class="bi bi-amazon"></i>
                        </a>
                    </div>
                    <small class="d-block d-lg-none text-muted mt-1">${device.real}</small>
                </td>
                <td class="d-none d-lg-table-cell text-muted">${device.real}</td>
                <td>
                    <span class="badge bg-success">Cabinet</span>
                </td>
                <td class="d-none d-md-table-cell">
                    <span if.bind="device.addedIn" class="badge purple">${device.addedIn}</span>
                </td>
            </tr>

            <!-- Effects Section -->
            <tr class="table-section" if.bind="getDevicesByType($displayData, 'effect').length">
                <td colspan="4" class="section-header" click.trigger="toggleSection('effect', $event)">
                    <div class="d-flex align-items-center justify-content-between">
                        <div class="d-flex align-items-center gap-3">
                            <span class="category-icon effect">
                                <i class="bi bi-sliders"></i>
                            </span>
                            <span class="fw-semibold">Effects</span>
                            <span class="text-muted">(${getDevicesByType($displayData, 'effect').length})</span>
                        </div>
                        <i class="bi ${effectCollapsed ? 'bi-chevron-right' : 'bi-chevron-down'} text-muted"></i>
                    </div>
                </td>
            </tr>
            <tr repeat.for="device of getDevicesByType($displayData, 'effect')"
                if.bind="!effectCollapsed"
                class="fade-in">
                <td>
                    <div class="d-flex align-items-center gap-2">
                        <span click.trigger="showDetail(device)" class="device-name">${device.name}</span>
                        <a if.bind="getDetailForDevice(device)?.amazonAffiliateLink"
                           href="${getDetailForDevice(device).amazonAffiliateLink}"
                           target="_blank"
                           class="text-warning"
                           title="Buy on Amazon">
                            <i class="bi bi-amazon"></i>
                        </a>
                    </div>
                    <small class="d-block d-lg-none text-muted mt-1">${device.real}</small>
                </td>
                <td class="d-none d-lg-table-cell text-muted">${device.real}</td>
                <td>
                    <span class="badge bg-info">Effect</span>
                </td>
                <td class="d-none d-md-table-cell">
                    <span if.bind="device.addedIn" class="badge purple">${device.addedIn}</span>
                </td>
            </tr>

            <!-- Captures Section -->
            <tr class="table-section" if.bind="getDevicesByType($displayData, 'capture').length">
                <td colspan="4" class="section-header" click.trigger="toggleSection('capture', $event)">
                    <div class="d-flex align-items-center justify-content-between">
                        <div class="d-flex align-items-center gap-3">
                            <span class="category-icon capture">
                                <i class="bi bi-record-circle"></i>
                            </span>
                            <span class="fw-semibold">Captures</span>
                            <span class="text-muted">(${getDevicesByType($displayData, 'capture').length})</span>
                        </div>
                        <i class="bi ${captureCollapsed ? 'bi-chevron-right' : 'bi-chevron-down'} text-muted"></i>
                    </div>
                </td>
            </tr>
            <tr repeat.for="device of getDevicesByType($displayData, 'capture')"
                if.bind="!captureCollapsed"
                class="fade-in">
                <td>
                    <div class="d-flex align-items-center gap-2">
                        <span click.trigger="showDetail(device)" class="device-name">${device.name}</span>
                        <a if.bind="getDetailForDevice(device)?.amazonAffiliateLink"
                           href="${getDetailForDevice(device).amazonAffiliateLink}"
                           target="_blank"
                           class="text-warning"
                           title="Buy on Amazon">
                            <i class="bi bi-amazon"></i>
                        </a>
                    </div>
                    <small class="d-block d-lg-none text-muted mt-1">${device.real}</small>
                </td>
                <td class="d-none d-lg-table-cell text-muted">${device.real}</td>
                <td>
                    <span class="badge bg-warning">Capture</span>
                </td>
                <td class="d-none d-md-table-cell">
                    <span if.bind="device.addedIn" class="badge purple">${device.addedIn}</span>
                </td>
            </tr>

            <!-- Plugins Section -->
            <tr class="table-section" if.bind="getPluginDevices($displayData).length">
                <td colspan="4" class="section-header" click.trigger="toggleSection('plugins', $event)">
                    <div class="d-flex align-items-center justify-content-between">
                        <div class="d-flex align-items-center gap-3">
                            <span class="category-icon plugin">
                                <i class="bi bi-puzzle"></i>
                            </span>
                            <span class="fw-semibold">Paid Plugins</span>
                            <span class="text-muted">(${getPluginDevices($displayData).length})</span>
                        </div>
                        <i class="bi ${pluginsCollapsed ? 'bi-chevron-right' : 'bi-chevron-down'} text-muted"></i>
                    </div>
                </td>
            </tr>
            <tr repeat.for="device of getPluginDevices($displayData)"
                if.bind="!pluginsCollapsed"
                class="fade-in">
                <td>
                    <div class="d-flex align-items-center gap-2">
                        <span click.trigger="showDetail(device)" class="device-name">${device.name}</span>
                        <a if.bind="getDetailForDevice(device)?.amazonAffiliateLink"
                           href="${getDetailForDevice(device).amazonAffiliateLink}"
                           target="_blank"
                           class="text-warning"
                           title="Buy on Amazon">
                            <i class="bi bi-amazon"></i>
                        </a>
                    </div>
                    <small class="d-block d-lg-none text-muted mt-1">${device.real}</small>
                </td>
                <td class="d-none d-lg-table-cell text-muted">${device.real}</td>
                <td>
                    <span class="badge green">${device.deviceTypeLabel}</span>
                </td>
                <td class="d-none d-md-table-cell">
                    <span if.bind="device.addedIn" class="badge purple">${device.addedIn}</span>
                </td>
            </tr>
        </tbody>
    </table>
</div>
